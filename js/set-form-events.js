import{collection,addDoc,getDocs,doc,updateDoc,increment,getFirestore}from"./firestore.js";import{updateContainerHeight,updateCounter}from"./helpers.js";const db=getFirestore();export function setFormEvents(){document.getElementById("form").onsubmit=formOnSubmit}function formOnSubmit(e){e.preventDefault();const t=document.getElementById("input");addTextToDb(t.value),insertTask(t.value),t.value="",updateContainerHeight()}async function addTextToDb(e){await addDoc(collection(db,"todo-items"),{text:e,status:"active",order:1});const t=document.querySelectorAll(".task-row"),o=[];for(const e of t)o.push(e.dataset.id);(await getDocs(collection(db,"todo-items"))).forEach(e=>{o.includes(e.id)?(incrementOrderInDb(e),incrementOrderInHtml(e.id)):setIdAttribute(e.id)})}function insertTask(e){const t=document.querySelector(".tasks-container ul"),o=window.screen.width<420?'<div class="lift-release-icon" role="button" aria-pressed="false"></div>':"";t.insertAdjacentHTML("afterbegin",`<li class="task-row opace draggable" data-id="null" data-status="active" data-order="1">\n      <div class="task-container">\n        <div role="checkbox" aria-checked="false" class="checkbox">\n          <img height="9px" width="11px" src="/todo-app/img/icon-check.svg" alt="check icon" class="hidden" />\n        </div>\n        <div class="task">${e}</div>\n      </div>\n      ${o}\n      <div role="button" aria-pressed="false" class="cross-icon"></div>\n    </li>`),updateCounter(),setTimeout(()=>document.querySelector(".opace").classList.toggle("opace"))}function setIdAttribute(e){document.querySelector('[data-id="null"]').dataset.id=e}function incrementOrderInDb(e){const t=doc(db,"todo-items",e.id);updateDoc(t,{order:increment(1)})}function incrementOrderInHtml(e){const t=document.querySelector(`li[data-id='${e}']`);t.dataset.order=+t.dataset.order+1}