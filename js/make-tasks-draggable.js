import{doc,updateDoc,getFirestore}from"https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";export function makeTasksDraggable(){const e=event.target.closest(".draggable");if(!e)return;event.preventDefault(),document.ondragstart=function(){return!1};const t=document.createElement("li"),n=setTimeout(()=>{document.removeEventListener("pointermove",b),t.className="task-row task-placeholder",t.style.height=c+"px",e.replaceWith(t),document.addEventListener("pointermove",E),document.body.append(e),e.style.width=a+"px",e.style.height=c+"px",e.style.left=l,e.style.top=m,e.style.position="absolute"},300),o=event.pageY;let r;const i=e.getBoundingClientRect(),s=event.clientX-i.left,d=event.clientY-i.top,a=i.width,c=i.height,l=event.pageX-s+"px",m=event.pageY-d+"px";let p,u,v,g,f;function E(){let n=event.pageX-s,i=event.pageY-d;const a=e.offsetHeight,l=e.offsetWidth,m=document.documentElement.scrollTop,p=document.documentElement.clientWidth,u=document.documentElement.clientHeight+m;!function(e,t,n){r||(r=o-d);const i=r-t;i>n/2&&e.previousElementSibling&&(e.previousElementSibling.before(e),r-=n);i<-n/2&&e.nextElementSibling&&!e.nextElementSibling.classList.contains("tasks-status")&&(e.nextElementSibling.after(e),r+=n)}(t,i,c),n<0&&(n=0),n>p-l&&(n=p-l),i<m&&(i=m),i+a>u&&(i=u-a),i===m&&m>=20&&(window.scrollBy(0,-20),i-=20),i===u-a&&document.documentElement.scrollHeight-u>=20&&(window.scrollBy(0,20),i+=20),e.style.top=i+"px",e.style.left=n+"px"}function b(){p||(u=i.left,v=i.right,g=i.top,f=i.bottom,p=!0);const e=event.clientX,t=event.clientY;(e<u||e>v||t<g||t>f)&&(document.dispatchEvent(new Event("pointerup")),document.removeEventListener("pointermove",b))}document.addEventListener("pointermove",b),document.addEventListener("pointerup",function o(){clearTimeout(n);document.removeEventListener("pointermove",E);document.removeEventListener("pointerup",o);document.removeEventListener("pointermove",b);t.classList.contains("task-row")&&(swapOrder(e,t),t.replaceWith(e),t.remove(),e.style.cssText="")})}function swapOrder(e,t){const n=t.previousElementSibling,o=t.nextElementSibling;if(!n){const t=+o.dataset.order/2;return e.dataset.order=t,void updateDbOrder(t,e.dataset.id)}if(!o){const t=+n.dataset.order+1;return e.dataset.order=t,void updateDbOrder(t,e.dataset.id)}const r=(+n.dataset.order+ +o.dataset.order)/2;e.dataset.order=r,updateDbOrder(r,e.dataset.id)}async function updateDbOrder(e,t){const n=await getFirestore(),o=doc(n,"todo-items",t);updateDoc(o,{order:e})}